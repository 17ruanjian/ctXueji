@{
    Layout = "~/_xuejiLayout.cshtml";
    var db = Database.Open("ctXueji");
    string[] weekdays = { "7", "1", "2", "3", "4", "5", "6" };

    var week = "";
    string nowyear = DateTime.Now.Year.ToString();
    string weeks = weekdays[Convert.ToInt32(Convert.ToDateTime(nowyear + "-01-01").DayOfWeek)];
    var weeksint = Convert.ToInt16(weeks);
    var time = DateTime.Now;
    var timeyear = time.Year;
    int yeardays = time.DayOfYear;
    int goday = 0;
    if (weeksint == 1)     //本年的第几周
    {
        goday = yeardays / 7;
        goday += 1;
    }
    else
    {
        goday = (yeardays + weeksint - 1) / 7;
    }
    var weekArranging = "select * from weekArranging where wa_years = " + timeyear;
    foreach (var weekA in db.Query(weekArranging))
    {
        if (goday > weekA.wa_startWeek && goday < weekA.wa_endWeek)
        {
            Session["session"] = weekA.id;
        }
    }
    var authority = Session["authority"].ToString();
}
@goday
<style>
    .t {
        height: 80px;
        background-color: #dedef8;
        box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px #444;
        text-align: center;
        line-height: 80px;
    }

    .c {
        background-color: #dedef8;
        box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px #444;
        text-align: center;
    }

    .ing {
        background-color: #84ff7a;
    }
</style>
<div class="container">
    <div class="row">
        <div class="col-md-2 t">课节/星期</div>
        <div class="col-md-2 t">星期一</div>
        <div class="col-md-2 t">星期二</div>
        <div class="col-md-2 t">星期三</div>
        <div class="col-md-2 t">星期四</div>
        <div class="col-md-2 t">星期五</div>
    </div>
    @if (authority == "2")
    {
        for (int n = 1; n <= 5; n++)
        {
            <div class="row">
                <div class="col-md-2 c">@Functions.LessonsOrder(n)</div>
                @{
                    for (int i = 1; i <= 5; i++)
                    {
                        var times = "select * from times where id=" + n;
                        var r = db.QuerySingle(times);
                        <div class="col-md-2 c @Functions.Classesing(i,r.date_times)">
                            @{
                                week = "select * from View_coursesArranging_one where weekDays = " + i + "and lessonsOrder=" + n;
                            }
                            @foreach (var cellRow in db.Query(week))
                            {
                                <span>@cellRow.class_name 教室<br>@cellRow.teachers_name<br>(@cellRow.courses_name)</span><br />
                                <hr />
                            }
                            <a href="~/classtime_add.cshtml?week_id=@i&order_id=@n">新增</a>
                            <a href="~/classtime_edit.cshtml?week_id=@i&order_id=@n">修改</a>
                        </div>
                    }
                }
            </div>
        }
    }
    else if (authority == "3")
    {
       Response.Redirect("classtimec");
    }
    else if (authority == "1")
    {
        var t = "select * from teachers where teachers_name = '" + Session["name"]+"'";
        var teachers_id = db.QuerySingle(t).id;
        for (int n = 1; n <= 5; n++)
        {
            <div class="row">
                <div class="col-md-2 c">@Functions.LessonsOrder(n)</div>
                @{
                    for (int i = 1; i <= 5; i++)
                    {
                        <div class="col-md-2 c">
                            @{
                                week = "select * from View_coursesArranging_one where weekDays = " + i + "and lessonsOrder=" + n + "and teachers_id=" + teachers_id;
                            }
                            @foreach (var cellRow in db.Query(week))
                            {
                                <span>@cellRow.class_name 教室<br>@cellRow.teachers_name<br>(@cellRow.courses_name)</span><br>
                            }
                        </div>
                    }
                }
            </div>
        }
    }
</div>
@*<div class="row">
        <div class="col-md-2 c">First(8:00-9:30)</div>
    </div>*@
@*<div class="row">
        <div class="col-md-2 c">Second<br />(10:00-11:30)</div>
    </div>
    <div class="row">
        <div class="col-md-2 c">Third<br />(13:00-14:30)</div>
    </div>
    <div class="row">
        <div class="col-md-2 c">Fourth<br />(15:00-16:30)</div>
    </div>
    <div class="row">
        <div class="col-md-2 c">Fifth<br />(17:00-18:30)</div>
    </div>*@



@*<p class="popover-options">
        <a href="#" type="button" class="" title="<h2>Title</h2>"
           data-container="body" data-toggle="popover" data-content="
                                                                         <h4>Popover 中的一些内容 —— options 方法</h4>">
                Popover
            </a>
    </p>
    <script>
            $(function () { $(".popover-options a").popover({html : true });});
    </script>*@
